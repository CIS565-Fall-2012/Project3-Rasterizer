<?xml version="1.0" encoding="utf-8"?>
<ProjectSchemaDefinitions
    xmlns="clr-namespace:Microsoft.Build.Framework.XamlTypes;assembly=Microsoft.Build.Framework"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:sys="clr-namespace:System;assembly=mscorlib">

    <!--
        Common properties:
            AdditionalDeps
            CompileOut
            Include
            Keep
            NvccCompilation
            NvccPath
            RequiredIncludes
            TargetMachinePlatform

        Device properties:
            Arch
            CInterleavedPTX
            GPUDebugInfo
            MaxRegCount
            PtxAsOptionV

        Host properties:
            Defines
            Emulation
            HostDebugInfo
            FastMath
            Optimization
            Runtime
            RuntimeChecks
            TypeInfo
            Warning

        Command Line properties:
            AdditionalOptions
            CommandLineTemplate

        Unused?:
            DontUseProfile (-noprof)
            LibraryPaths (-L)
            Library (-l)
            CompilerOptions (-Xcompiler)
            LinkerOptions (-Xlinker)
            PreInclude (-pre-include)
    -->

    <ItemType Name="CudaCompile" DisplayName="CUDA C/C++" />

    <FileExtension Name="*.cu" ContentType="CudaCompile" />

    <ContentType Name="CudaCompile" DisplayName="CUDA C/C++" ItemType="CudaCompile" />

    <Rule Name="CudaCompile" PageTemplate="tool" DisplayName="CUDA C/C++" Order="12">
        <Rule.DataSource>
            <DataSource Persistence="ProjectFile" ItemType="CudaCompile" />
        </Rule.DataSource>

        <Rule.Categories>
            <Category Name="Common" DisplayName="Common" />
            <Category Name="Device" DisplayName="Device" />
            <Category Name="Host" DisplayName="Host" />
            <Category Name="Command Line" DisplayName="Command Line" Subtype="CommandLine" />
        </Rule.Categories>

        <Rule.Properties>
            <!-- /////////////////////////////////////////////////////////////////////////////////// Common properties -->
            <StringProperty
                Name="CudaToolkitCustomDir"
                Subtype="folder"
                DisplayName="CUDA Toolkit Custom Dir"
                Category="Common"
                Description="Custom path to the CUDA Toolkit."
                IncludeInCommandLine="False">
                <StringProperty.DataSource>
                    <DataSource Persistence="ProjectFile" HasConfigurationCondition="false" Label="Globals" />
                </StringProperty.DataSource>
            </StringProperty>

            <StringListProperty
                Name="AdditionalDeps"
                DisplayName="Source Dependencies"
                Category="Common"
                Description="Add additional source file dependencies.  Dependencies that are #include'd do not have to be explicitly specified here."
                Switch="[value]" />

            <StringProperty
                Name="CompileOut"
                DisplayName="Compiler Output (obj/cubin)"
                Category="Common"
                Subcategory="Compiler"
                Description="Sets output as an obj or cubin file."
                Switch="[value]" />

            <StringListProperty
                Name="Include"
                DisplayName="Additional Include Directories"
                Category="Common"
                Description="Specifies one or more directories to add to the include path; use semi-colon delimited list if more than one. (/I[path])"
                Switch="-I&quot;[value]&quot;"
                RendererValueSeparator=";" />

            <BoolProperty
                Name="Keep"
                DisplayName="Keep Preprocessed Files"
                Category="Common"
                Description="Specifies that preprocessor files generated by the CUDA compiler are not deleted, i.e., .ptx, .cubin, .cudafe1.c, etc. (--keep)"
                Switch="--keep" />

            <StringProperty
                Name="KeepDir"
                Subtype="folder"
                DisplayName="Keep Directory"
                Category="Common"
                Description="Path to the directory where preprocessor files generated by the CUDA compiler will be kept."
                Switch="--keep-dir &quot;[value]&quot;" />

            <EnumProperty
                Name="NvccCompilation"
                DisplayName="NVCC Compilation Type"
                Category="Common"
                Subcategory="Compiler"
                Description="Selected desired output of NVCC compilation (-c/-compile, -cuda, -gpu, -cubin, -ptx).">

                <EnumValue
                    Name="compile"
                    DisplayName="Generate hybrid object file"
                    Switch="--compile" />

                <EnumValue
                    Name="cuda"
                    DisplayName="Generate hybrid .c file"
                    Switch="-cuda" />

                <EnumValue
                    Name="gpu"
                    DisplayName="Generate .gpu file file"
                    Switch="-gpu" />

                <EnumValue
                    Name="cubin"
                    DisplayName="Generate .cubin file"
                    Switch="-cubin" />

                <EnumValue
                    Name="ptx"
                    DisplayName="Generate .ptx file"
                    Switch="-ptx" />
            </EnumProperty>

            <StringProperty
                Name="NvccPath"
                DisplayName="Compiler Path"
                Category="Common"
                ReadOnly="true"
                Description="Designated path to nvcc.exe."
                Switch="&quot;[value]&quot;"
                Visible="false" />

            <StringListProperty
                Name="RequiredIncludes"
                DisplayName="Required Include Directories"
                Category="Common"
                ReadOnly="true"
                Description="This include must exist for CUDA headers to be accessed."
                Switch="-I&quot;[value]&quot;"
                RendererValueSeparator=";"
                Visible="false" />

            <EnumProperty
                Name="TargetMachinePlatform"
                DisplayName="Target Machine Platform"
                Category="Common"
                Description="Select the platform for the target machine (x86 or x64).">

                <EnumValue
                    Name="32"
                    DisplayName="32-bit"
                    Switch="--machine 32" />

                <EnumValue
                    Name="64"
                    DisplayName="64-bit"
                    Switch="--machine 64" />
            </EnumProperty>

            <!-- /////////////////////////////////////////////////////////////////////////////////// Device properties -->

            <BoolProperty
                Name="CInterleavedPTX"
                DisplayName="C interleaved in PTXAS Output"
                Category="Device"
                Description="Insert source code in generated PTX."
                Switch="--opencc-options -LIST:source=on" />

            <StringListProperty
                Name="CodeGeneration"
                DisplayName="Code Generation"
                Category="Device"
                Description="Specifies the names of the NVIDIA GPUs to generate code for and the class of the NVIDIA GPU architectures for which the input files must be compiled.  Specify the architecture and code in the format [arch],[code], multiple arch/code pairs may be specified separated by a ; character if the NVCC Compilation Type is compile (CUDART).  Valid values for arch and code are compute_10, compute_11, compute_12, compute_13, compute20, compute30, sm_10, sm_11, sm_12, sm_13, sm_20, sm_21, sm_22, sm_23, sm_30."
                Switch="-gencode=[value]"
                RendererValueSeparator=";" />

            <BoolProperty
                Name="GPUDebugInfo"
                DisplayName="Generate GPU Debug Information"
                Category="Device"
                Description="Specifies whether or not GPU debugging information is generated by the CUDA Compiler. (-G0)"
                Switch="-G0" />

            <IntProperty
                Name="MaxRegCount"
                DisplayName="Max Used Register"
                Category="Device"
                Description="Specify the maximum amount of registers that GPU functions can use. (-maxrregcount)"
                Switch="-maxrregcount=[value]" />

            <BoolProperty
                Name="PtxAsOptionV"
                DisplayName="Verbose PTXAS Output"
                Category="Device"
                Description=""
                Switch="--ptxas-options=-v" />

            <!-- /////////////////////////////////////////////////////////////////////////////////// Host properties -->

            <StringListProperty
                Name="Defines"
                DisplayName="Preprocessor Definitions"
                Category="Host"
                Description="Specifies one or more preprocessor defines.  (-D[macro])"
                Switch="-D[value]"
                RendererValueSeparator=";" />

            <BoolProperty
                Name="Emulation"
                DisplayName="Emulation"
                Category="Host"
                Description="Specifies whether or not to generate emulated code.  (-deviceemu)"
                Switch="-deviceemu -D_DEVICEEMU" />

            <BoolProperty
                Name="HostDebugInfo"
                DisplayName="Generate Host Debug Information"
                Category="Host"
                Description="Specifies whether or not host debugging information is generated by the CUDA compiler. (-g)"
                Switch="-D_NEXUS_DEBUG -g" />

            <BoolProperty
                Name="FastMath"
                DisplayName="Use Fast Math"
                Category="Host"
                Description="Make use of the fast math library."
                Switch="-use_fast_math" />

            <EnumProperty
                Name="Optimization"
                DisplayName="Optimization"
                Category="Host"
                Description="Select option for code optimization; choose Custom to use specific optimization options. (/Od, /O1, /O2, /Ox)">

                <EnumValue
                    Name="Od"
                    DisplayName="Disabled"
                    Switch="/Od" />

                <EnumValue
                    Name="O1"
                    DisplayName="Minimize Size"
                    Switch="/O1" />

                <EnumValue
                    Name="O2"
                    DisplayName="Maximize Speed"
                    Switch="/O2" />

                <EnumValue
                    Name="O3"
                    DisplayName="Full Optimization"
                    Switch="/Ox" />
            </EnumProperty>

            <EnumProperty
                Name="Runtime"
                DisplayName="Runtime Library"
                Category="Host"
                Description="Specify runtime library for linking. (/Mt, /MTd, /MD, /MDd, /ML, /MLd)">

                <EnumValue
                    Name="MT"
                    DisplayName="Multi-Threaded"
                    Switch="/MT" />

                <EnumValue
                    Name="MTd"
                    DisplayName="Multi-Threaded Debug"
                    Switch="/MTd" />

                <EnumValue
                    Name="MD"
                    DisplayName="Multi-Threaded DLL"
                    Switch="/MD" />

                <EnumValue
                    Name="MDd"
                    DisplayName="Multi-threaded Debug DLL"
                    Switch="/MDd" />

                <EnumValue
                    Name="ML"
                    DisplayName="Single-Threaded"
                    Switch="/ML" />

                <EnumValue
                    Name="MLd"
                    DisplayName="Single-Threaded Debug"
                    Switch="/MLd" />
            </EnumProperty>

            <EnumProperty
                Name="RuntimeChecks"
                DisplayName="Basic Runtime Checks"
                Category="Host"
                Description="Perform basic runtime error checks, incompatible with any optimization type other than debug. (/RTCs, /RTCu, RTC1)">

                <EnumValue
                    Name="Default"
                    DisplayName="Default"
                    Switch="" />

                <EnumValue
                    Name="RTCs"
                    DisplayName="Stack Frames"
                    Switch="/RTCs" />

                <EnumValue
                    Name="RTCu"
                    DisplayName="Uninitialized Variables"
                    Switch="/RTCu" />

                <EnumValue
                    Name="RTC1"
                    DisplayName="Both"
                    Switch="/RTC1" />
            </EnumProperty>

            <BoolProperty
                Name="TypeInfo"
                DisplayName="Enumable Run-Time Type Info"
                Category="Host"
                Description="Adds code for checking C++ object types at run time (runtime type information). (/GR)"
                Switch="/GR" />

            <EnumProperty
                Name="Warning"
                DisplayName="Warning Level"
                Category="Host"
                Description="Select how strict you want the compiler to be about checking for potentially suspect constructs. (/W0 - /W4)">

                <EnumValue
                    Name="W0"
                    DisplayName="Off: Turn Off All Warnings"
                    Switch="/W0" />

                <EnumValue
                    Name="W1"
                    DisplayName="Level 1"
                    Switch="/W1" />

                <EnumValue
                    Name="W2"
                    DisplayName="Level 2"
                    Switch="/W2" />

                <EnumValue
                    Name="W3"
                    DisplayName="Level 3"
                    Switch="/W3" />

                <EnumValue
                    Name="W4"
                    DisplayName="Level 4"
                    Switch="/W4" />
            </EnumProperty>

            <!-- /////////////////////////////////////////////////////////////////////////////////// Command line properties -->

            <StringProperty
                Name="AdditionalOptions"
                DisplayName="Additional Options"
                Category="Command Line"
                Description="Additional Options" />

            <StringProperty
                Name="CommandLineTemplate"
                DisplayName="Command Line"
                Category="Command Line"
                Visible="False"
                IncludeInCommandLine="False" />

        </Rule.Properties>
    </Rule>
</ProjectSchemaDefinitions>
